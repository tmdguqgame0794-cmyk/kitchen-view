<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>주방 합계 (아이패드 호환 · v8)</title>
  <style>
    :root{ --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8; --line:#334155; }
    html,body{margin:0;height:100%;background:#0b1220;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Helvetica,Arial,sans-serif}
    .wrap{max-width:920px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 12px}
    .sub{color:var(--muted);font-size:12px;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;border-spacing:0;background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    th,td{padding:12px 14px;border-bottom:1px solid var(--line)}
    th{background:#0f172a;text-align:left;font-size:14px}
    td{font-size:18px}
    tr:last-child td{border-bottom:none}
    .qty{text-align:right;font-variant-numeric:tabular-nums}
    .foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:12px}
    .pill{border:1px solid var(--line);padding:4px 8px;border-radius:999px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>주방 합계 (GitHub Pages 호스팅용 뷰)</h1>
  <div class="sub">메뉴명과 현재 합계를 실시간으로 보여줍니다. (0 포함)</div>
  <table>
    <thead>
      <tr><th>메뉴</th><th class="qty">합계</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
  <div class="foot">
    <span id="status" class="pill">연결 대기</span>
    <span id="updated" class="pill">업데이트 없음</span>
  </div>
</div>

<!-- Firebase v8 (ES 모듈 아님: 아이패드 로컬 파일 호환) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
  // ---- 설정 ----
  var firebaseConfig = {
    apiKey: "AIzaSyCWBPv3YgGKOH0b1e59I3QG9SfRtcNZSDY",
    authDomain: "chookjae-8e133.firebaseapp.com",
    projectId: "chookjae-8e133",
    storageBucket: "chookjae-8e133.firebasestorage.app",
    messagingSenderId: "82575498649",
    appId: "1:82575498649:web:364e9c286a9f3ae7474708",
    measurementId: "G-BQ95TPG37V",
    databaseURL: "https://chookjae-8e133-default-rtdb.firebaseio.com"
  };
  var ROOM_ID = "CHOOKJAE";

  // ---- 초기 렌더(0 표시) ----
  var menuOrder = ["우삼겹숙주볶음","치즈김치전","만두계란탕","불닭콘치즈","치즈콘계란말이","두부김치","음료수"];
  var tbody = document.getElementById("tbody");
  function renderZeros() {
    tbody.innerHTML = "";
    menuOrder.forEach(function(menu){
      var tr=document.createElement("tr");
      var td1=document.createElement("td"); td1.textContent=menu;
      var td2=document.createElement("td"); td2.className="qty"; td2.textContent="0"; td2.dataset.key=menu;
      tr.appendChild(td1); tr.appendChild(td2); tbody.appendChild(tr);
    });
  }
  renderZeros();

  // ---- Firebase 연결 ----
  try {
    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();
    document.getElementById("status").textContent = "연결 시도중...";

    db.ref("orders/"+ROOM_ID+"/footerTotals").on("value", function(snap){
      var data = snap.val();
      document.getElementById("status").textContent = "연결됨";
      if (!data) return; // 값 없으면 0 유지
      menuOrder.forEach(function(menu){
        var cell = tbody.querySelector('td[data-key="'+menu+'"]');
        if (cell) cell.textContent = (data[menu] || 0);
      });
      if (data.updatedAt){
        var d=new Date(data.updatedAt);
        var pad=function(n){return String(n).padStart(2,"0")};
        document.getElementById("updated").textContent =
          "업데이트 " + d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+" "+pad(d.getHours())+":"+pad(d.getMinutes());
      }
    }, function(err){
      document.getElementById("status").textContent = "연결 오류";
      console.log(err);
    });
  } catch(e){
    document.getElementById("status").textContent = "초기화 실패";
    console.log(e);
  }
</script>
</body>
</html>
