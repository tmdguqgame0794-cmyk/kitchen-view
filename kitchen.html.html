<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>주방 합계 · CHOOKJAE (6+3 실시간)</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
      --line:#2b3444; --rowOdd:#0f172a; --rowEven:#101925;
      --flash:#3b82f6;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Helvetica,Arial,sans-serif}
    .wrap{min-height:100%;max-width:2000px;margin:0 auto;
      padding:env(safe-area-inset-top,16px) env(safe-area-inset-right,24px) env(safe-area-inset-bottom,20px) env(safe-area-inset-left,24px)}
    header{display:flex;align-items:baseline;gap:18px;margin:0 0 10px 0}
    h1{font-size:clamp(22px,4vh,44px);margin:0;font-weight:900;letter-spacing:.2px}
    .status{display:flex;gap:10px;align-items:center;margin-left:auto}
    .chip{border:1px solid var(--line);color:var(--muted);padding:8px 14px;border-radius:999px;
      font-size:clamp(12px,2vh,18px); white-space:nowrap}
    .chip.ok{border-color:#14532d;color:#bbf7d0;background:#052e16}
    .chip.err{border-color:#7f1d1d;color:#fecaca;background:#450a0a}

    .head{display:grid;grid-template-columns: 2fr 1fr; gap:18px;
      position:sticky;top:0;z-index:4;
      background:linear-gradient(to bottom, rgba(11,18,32,.96), rgba(11,18,32,.6));
      backdrop-filter:blur(2px); border-bottom:1px solid var(--line); padding:8px 4px 10px}
    .head > div{color:var(--muted);font-size:clamp(16px,2.6vh,22px)}

    .rows{display:grid;grid-auto-rows:auto; row-gap:16px; padding-top:8px}
    .row{display:grid;grid-template-columns: 2fr 1fr; gap:18px}
    .cell{border:1px solid var(--line);border-radius:18px;background:var(--panel);
      padding: clamp(12px,3.2vh,34px) clamp(16px,2.4vw,28px)}
    .menu{font-weight:1000; letter-spacing:.25px; line-height:1.15;
      font-size:clamp(30px,5.6vh,72px)}
    .qty{font-weight:1000; text-align:right; font-variant-numeric:tabular-nums;
      line-height:1; font-size:clamp(42px,7.4vh,110px)}

    .odd .cell{background:var(--rowOdd)}
    .even .cell{background:var(--rowEven)}

    .footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);
      margin-top:14px;font-size:clamp(12px,2vh,18px)}
    .legend{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--line);display:inline-block;margin-right:6px}
    .room{color:var(--ink);font-weight:800}
    @media (orientation: portrait){
      .menu{font-size:clamp(26px,4.8vh,60px)}
      .qty{font-size:clamp(36px,6vh,96px)}
    }
    .flash{animation:flash .6s ease}
    @keyframes flash{0%{box-shadow:0 0 0 0 rgba(59,130,246,.7)}100%{box-shadow:0 0 0 0 rgba(59,130,246,0)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>주방 합계 · 6+3</h1>
      <div class="status">
        <span id="conn" class="chip">연결 대기</span>
        <span id="upd" class="chip">업데이트 없음</span>
      </div>
    </header>

    <div class="head">
      <div>메뉴</div>
      <div style="text-align:right">합계</div>
    </div>

    <div id="rows" class="rows"></div>

    <div class="footer">
      <div class="legend">
        <span class="dot"></span><span>0도 표시 · 실시간 갱신</span>
      </div>
      <div>ROOM: <span class="room">CHOOKJAE</span></div>
    </div>
  </div>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyCWBPv3YgGKOH0b1e59I3QG9SfRtcNZSDY",
      authDomain: "chookjae-8e133.firebaseapp.com",
      projectId: "chookjae-8e133",
      storageBucket: "chookjae-8e133.firebasestorage.app",
      messagingSenderId: "82575498649",
      appId: "1:82575498649:web:364e9c286a9f3ae7474708",
      measurementId: "G-BQ95TPG37V",
      databaseURL: "https://chookjae-8e133-default-rtdb.firebaseio.com"
    };
    var ROOM_ID = "CHOOKJAE";
    var order = ["우삼겹숙주볶음","치즈김치전","만두계란탕","불닭콘치즈","치즈콘계란말이","두부김치","콜라","사이다","제로콜라"];

    var rowsEl = document.getElementById('rows');
    function renderSkeleton(){
      rowsEl.innerHTML = "";
      order.forEach(function(name, i){
        var row = document.createElement('div');
        row.className = 'row ' + (i%2===0?'odd':'even');
        var left = document.createElement('div'); left.className='cell menu'; left.textContent=name;
        var right = document.createElement('div'); right.className='cell qty'; right.textContent='0'; right.dataset.key=name;
        row.appendChild(left); row.appendChild(right);
        rowsEl.appendChild(row);
      });
    }
    renderSkeleton();

    function fmtTime(ms){
      if(!ms) return "업데이트 없음";
      var d=new Date(ms); var z=n=>String(n).padStart(2,'0');
      return "업데이트 "+d.getFullYear()+"-"+z(d.getMonth()+1)+"-"+z(d.getDate())+" "+z(d.getHours())+":"+z(d.getMinutes());
    }
    function flash(cell){
      cell.classList.remove('flash');
      cell.offsetWidth; // reflow
      cell.classList.add('flash');
    }

    try{
      firebase.initializeApp(firebaseConfig);
      var db=firebase.database();
      document.getElementById('conn').textContent='연결 시도중…';

      var ref = db.ref('orders/'+ROOM_ID+'/footerTotals');
      var prev = {};
      ref.on('value', function(snap){
        var v=snap.val();
        var connEl=document.getElementById('conn');
        connEl.textContent='연결됨'; connEl.classList.remove('err'); connEl.classList.add('ok');

        if(!v){ return; }
        order.forEach(function(name){
          var cell = rowsEl.querySelector('[data-key="'+name+'"]');
          var next = (v[name]||0);
          if(cell){
            var before = Number(cell.textContent)||0;
            if(before !== next){ flash(cell.parentElement); }
            cell.textContent = String(next);
          }
        });
        document.getElementById('upd').textContent = fmtTime(v.updatedAt);
      }, function(err){
        var connEl=document.getElementById('conn');
        connEl.textContent='연결 오류'; connEl.classList.add('err');
        console.log(err);
      });
    }catch(e){
      document.getElementById('conn').textContent='초기화 실패'; 
      document.getElementById('conn').classList.add('err');
      console.log(e);
    }
  </script>
</body>
</html>